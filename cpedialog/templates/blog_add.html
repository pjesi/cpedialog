{% extends "main.html" %}

{% block title %}CPEDIA's Blog -  {% ifequal action "addBlog" %}
Add item
{% endifequal %}
{% ifequal action "editBlog" %}
Edit item
{% endifequal %}
{% ifequal action "editBlogReaction" %}
Edit reaction
{% endifequal %}
{% endblock %}

{% block blogcontainer %}
        
<script language="javascript" type="text/javascript" src="/jscripts/tiny_mce/tiny_mce.js"></script>
<script language="javascript" type="text/javascript">
    tinyMCE.init({
        mode : "textareas",
        theme : "advanced",
        theme_advanced_toolbar_location : "top",
        auto_resize:false,
        extended_valid_elements: "textarea[name|class|cols|rows]",
        remove_linebreaks : false,
        plugins : 'emotions',
        theme_advanced_toolbar_align : "left",
        theme_advanced_buttons1_add : "emotions",
        theme_advanced_buttons2_add : "separator,forecolor,backcolor",
        theme_advanced_buttons3_add_before : "fontselect,fontsizeselect,zoom",
        tab_focus : ':prev,:next'
    });
</script>

<div class="yui-g">
<script type="text/javascript">
    function parseBlogContent(){
        var content = window.frames[0].document.getElementById('tinymce').innerHTML;
        document.getElementById("text_input").value = content;
        return true;
    }
</script>
<div id="blogview">
    
     {% if error %}
    <div class="error">
        {{error}}
    </div>
     {% endif %}

    <div>
    <form method=post action='/{{action}}?preview=1' onsubmit="return parseBlogContent()" id="previewForm">
        <h4>
            {% ifequal action "addBlog" %}
            Add item
            {% endifequal %}
            {% ifequal action "editBlog" %}
            Edit item
            {% endifequal %}
            {% ifequal action "editBlogReaction" %}
            Edit reaction
            {% endifequal %}
        </h4>

        {% ifnotequal action "editBlogReaction" %}
        <div id="blogtitle">
         <input name=title_input id="title_input" type=text size="60"
               value='{% if blog %}{{blog.title}}{% endif %}'>
            <label for="title_input"><b>Title</b>(required)</label>
        </div>

        <div id="blogtags">
         <input type=text size="60" id="tags" name="tags" value="{% if blog %}{{blog.tags_commas}}{% endif %}">
         <label for="tags"><b>Tags</b>(required)</label>
        </div>
        {% endifnotequal %}

        {% ifequal action "editBlogReaction" %}
        <h2 class="comments-post">About the author</h2>
        <div>
            <input id="name_input" name='name_input' type=text size="60" value="{% if blogReaction %}{{blogReaction.user}}{% endif %}">
            <label for="name_input"><b>Name</b> (required)</label>
        </div>
        <div>
            <input id="mail" name="mail" type=text size="60" value="{% if blogReaction %}{{blogReaction.authorEmail}}{% endif %}">
            <label for="mail"><b>Mail</b> (required)</label>
        </div>
        <div>
            <input id="website" name="website" type=text size="60" value="{% if blogReaction %}{{blogReaction.authorWebsite}}{% endif %}">
            <label for="website"><b>Website</b></label>
        </div>
        {% endifequal %}

        <div id="blogpost">
        <h2 class="comments-post">Content</h2>
        <textarea id="editor" name="editor" rows="20" cols="75">
            {% if blog %}{{blog.content}}{% endif %}
            {% if blogReaction %}{{blogReaction.content}}{% endif %}
        </textarea>
        </div>
        
        {% ifequal action "editBlog" %}
        {% if blog %}
        <input name="blogId" type="hidden" value="{{blog.key.id}}">
        {% endif %}
        {% endifequal %}

        {% ifequal action "editBlogReaction" %}
        {% if blogReaction %}
        <input name="blogReactionId" type="hidden" value="{{blogReaction.key.id}}">
        {% endif %}
        {% endifequal %}
        <br>
        {% ifequal action "addBlog" %}
        <input name=submit_preview type=submit value=preview>
        {% else %}
        <input name=submit_edit type=submit value=submit>
        {% endifequal %}
         <input name=text_input type="hidden"/><br><br>
    </form>
    </div>
    {% ifequal preview '1' %}
    {% ifnotequal submitted '1' %}
    <script type="text/javascript">
        function parseConfirmContent() {
            var content = document.getElementById('blogcontent').innerHTML;
            document.forms["submitForm"]["text_input"].value = content;
            document.forms["submitForm"]["submitted"].value = "1";
            return true;
        }
    </script>
    <div>
    <form method=post action='/addBlog' onsubmit="return parseConfirmContent()" id="submitForm">
        <H2 class=date-header>{{blog.date|date:"l, F m, Y"}}</H2>

        <DIV class="post">
            <H3 class=post-title>
                <a href="#">{{blog.title}}</a>
            </H3>

            <DIV class=post-body id="blogcontent">
                {{blog.content}}
            </DIV>
            <DIV class=post-footer>
                {% if blog.tags %}
                <p>
                    Tags:
                    {% for tag in blog.tags %}
                    <a href="/tag/{{ tag|urlencode }}">{{ tag }}</a>
                    {% endfor %}
                </p>
                {% endif %}
                <P>
                    <SPAN class=post-author>Posted by {{blog.author}} </SPAN>
                   <SPAN class=post-timestamp>at
                       <A class=timestamp-link href="{{blog.permalink}}">{{blog.date|date:"H:i A"}}</A>
                   </SPAN>
                </P>
                 <br>
            </DIV>

        </DIV>

        <input name=title_input type=hidden value="{{blog.title}}">
        <input name=text_input type="hidden"/>
        <input name=submitted type=hidden value='0'>
        <input name=submit_add type=submit value=submit>

    </form>
    </div>
    {% endifnotequal%}
    {% endifequal%}
</div>
</div>
{% endblock %}
